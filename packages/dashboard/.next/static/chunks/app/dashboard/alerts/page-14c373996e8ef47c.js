(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[480],{7078:function(e,t,r){Promise.resolve().then(r.bind(r,3816))},4859:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(9566)},9566:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?l=n.concat(l):u=-1,l.length&&h())}function h(){if(!c){var e=i(d);c=!0;for(var t=l.length;t;){for(n=l,l=[];++u<t;)n&&n[u].run();u=-1,t=l.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function x(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];l.push(new g(e,t)),1!==l.length||c||i(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=x,a.addListener=x,a.once=x,a.off=x,a.removeListener=x,a.removeAllListeners=x,a.emit=x,a.prependListener=x,a.prependOnceListener=x,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},o=!0;try{t[e](s,s.exports,n),o=!1}finally{o&&delete r[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()},3816:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var n=r(7573),a=r(7653),s=r(5118);let o={critical:"bg-red-500/20 text-red-400 border-red-800",high:"bg-orange-500/20 text-orange-400 border-orange-800",medium:"bg-yellow-500/20 text-yellow-400 border-yellow-800",low:"bg-gray-500/20 text-gray-400 border-gray-700",info:"bg-blue-500/20 text-blue-400 border-blue-800"};function i(){let[e,t]=(0,a.useState)([]),[r,i]=(0,a.useState)(0),[l,c]=(0,a.useState)({status:"open",severity:""}),[u,d]=(0,a.useState)([]);async function h(){let e=new URLSearchParams({pageSize:"50",...l.status&&{status:l.status},...l.severity&&{severity:l.severity}}),r=await (0,s.SC)("/alerts?".concat(e));t(r.data),i(r.total)}async function g(e){await (0,s.SC)("/alerts/".concat(e,"/acknowledge"),{method:"POST",body:JSON.stringify({})}),h()}async function x(){u.length&&(await (0,s.SC)("/alerts/batch-acknowledge",{method:"POST",body:JSON.stringify({ids:u})}),d([]),h())}(0,a.useEffect)(()=>{h()},[l]);let m={critical:e.filter(e=>"critical"===e.severity).length,high:e.filter(e=>"high"===e.severity).length,medium:e.filter(e=>"medium"===e.severity).length,open:e.filter(e=>"open"===e.status).length};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-white",children:"告警中心"}),(0,n.jsx)("div",{className:"grid grid-cols-4 gap-4",children:[{label:"CRITICAL",value:m.critical,color:"text-red-400"},{label:"HIGH",value:m.high,color:"text-orange-400"},{label:"MEDIUM",value:m.medium,color:"text-yellow-400"},{label:"待处理",value:m.open,color:"text-white"}].map(e=>(0,n.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-4 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold ".concat(e.color),children:e.value}),(0,n.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:e.label})]},e.label))}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsxs)("select",{value:l.status,onChange:e=>c(t=>({...t,status:e.target.value})),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:outline-none",children:[(0,n.jsx)("option",{value:"",children:"全部状态"}),(0,n.jsx)("option",{value:"open",children:"未处理"}),(0,n.jsx)("option",{value:"acknowledged",children:"已确认"})]}),(0,n.jsxs)("select",{value:l.severity,onChange:e=>c(t=>({...t,severity:e.target.value})),className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:outline-none",children:[(0,n.jsx)("option",{value:"",children:"全部严重度"}),(0,n.jsx)("option",{value:"critical",children:"CRITICAL"}),(0,n.jsx)("option",{value:"high",children:"HIGH"}),(0,n.jsx)("option",{value:"medium",children:"MEDIUM"}),(0,n.jsx)("option",{value:"low",children:"LOW"})]}),u.length>0&&(0,n.jsxs)("button",{onClick:x,className:"bg-blue-700 hover:bg-blue-600 text-white px-3 py-1.5 rounded-lg text-sm",children:["批量确认 (",u.length,")"]}),(0,n.jsxs)("span",{className:"text-gray-500 text-sm ml-auto",children:["共 ",r," 条"]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[0===e.length&&(0,n.jsxs)("div",{className:"text-center py-16 text-gray-500",children:[(0,n.jsx)("p",{className:"text-4xl mb-3",children:"✓"}),(0,n.jsx)("p",{children:"暂无告警"})]}),e.map(e=>{var t;return(0,n.jsx)("div",{className:"border rounded-xl p-4 ".concat(null!==(t=o[e.severity])&&void 0!==t?t:"border-gray-800 bg-gray-900"," ").concat("acknowledged"===e.status?"opacity-50":""),children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[(0,n.jsx)("input",{type:"checkbox",checked:u.includes(e.id),onChange:()=>{var t;return t=e.id,void d(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"mt-1 accent-blue-500"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,n.jsx)("span",{className:"text-xs font-bold uppercase",children:e.severity}),(0,n.jsx)("span",{className:"text-xs text-gray-500 bg-gray-800 px-2 py-0.5 rounded",children:e.type}),(0,n.jsx)("span",{className:"text-xs text-gray-500 ml-auto",children:new Date(e.created_at).toLocaleString()})]}),(0,n.jsx)("p",{className:"text-sm font-medium text-white",children:e.title}),(0,n.jsx)("p",{className:"text-xs text-gray-400 mt-0.5",children:e.message}),e.agent_id&&(0,n.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Agent: ",e.agent_id]})]}),"open"===e.status&&(0,n.jsx)("button",{onClick:()=>g(e.id),className:"shrink-0 text-xs px-3 py-1 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-300",children:"确认"}),"acknowledged"===e.status&&(0,n.jsx)("span",{className:"shrink-0 text-xs text-gray-600",children:"已确认"})]})},e.id)})]})]})}},5118:function(e,t,r){"use strict";r.d(t,{SC:function(){return a},jl:function(){return s},kS:function(){return o}});let n=r(4859).env.NEXT_PUBLIC_API_URL||"/api";async function a(e,t){let r=localStorage.getItem("ag_token"),a=await fetch("".concat(n).concat(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...null==t?void 0:t.headers}});if(401===a.status)throw localStorage.removeItem("ag_token"),window.location.href="/login",Error("Unauthorized");if(!a.ok)throw Error((await a.json().catch(()=>({}))).message||"HTTP ".concat(a.status));return a.json()}function s(){return!!localStorage.getItem("ag_token")}function o(){localStorage.removeItem("ag_token"),window.location.href="/login"}}},function(e){e.O(0,[293,528,744],function(){return e(e.s=7078)}),_N_E=e.O()}]);