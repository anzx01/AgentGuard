(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[455],{1044:function(e,t,r){Promise.resolve().then(r.bind(r,8635))},4859:function(e,t,r){"use strict";var n,a;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(a=r.g.process)?void 0:a.env)?r.g.process:r(9566)},9566:function(e){!function(){var t={229:function(e){var t,r,n,a=e.exports={};function s(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var i=[],c=!1,u=-1;function d(){c&&n&&(c=!1,n.length?i=n.concat(i):u=-1,i.length&&x())}function x(){if(!c){var e=l(d);c=!0;for(var t=i.length;t;){for(n=i,i=[];++u<t;)n&&n[u].run();u=-1,t=i.length}n=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];i.push(new g(e,t)),1!==i.length||c||l(x)},g.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=h,a.addListener=h,a.once=h,a.off=h,a.removeListener=h,a.removeAllListeners=h,a.emit=h,a.prependListener=h,a.prependOnceListener=h,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}}},r={};function n(e){var a=r[e];if(void 0!==a)return a.exports;var s=r[e]={exports:{}},o=!0;try{t[e](s,s.exports,n),o=!1}finally{o&&delete r[e]}return s.exports}n.ab="//";var a=n(229);e.exports=a}()},8635:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var n=r(7573),a=r(7653),s=r(5118);function o(){var e,t,r,o,c,u;let[d,x]=(0,a.useState)({}),[g,h]=(0,a.useState)(!1),[m,p]=(0,a.useState)(""),[f,y]=(0,a.useState)(""),[b,v]=(0,a.useState)(!1),[j,w]=(0,a.useState)({current:"",next:"",confirm:""}),[N,_]=(0,a.useState)(""),[S,C]=(0,a.useState)([]),[T,k]=(0,a.useState)({alias:"",target_url:""}),[X,E]=(0,a.useState)(null);async function O(){x(await (0,s.SC)("/settings")),C((await (0,s.SC)("/service-aliases")).aliases)}async function P(){await (0,s.SC)("/settings",{method:"PUT",body:JSON.stringify(d)}),h(!0),setTimeout(()=>h(!1),2e3)}async function L(){y("");try{let e=await (0,s.SC)("/license/activate",{method:"POST",body:JSON.stringify({key:m})});y("✓ ".concat(e.message,"（").concat(e.plan,"）")),v(!0),O()}catch(e){y("✗ ".concat(e.message)),v(!1)}}async function I(){if(_(""),j.next!==j.confirm){_("两次密码不一致");return}try{await (0,s.SC)("/auth/change-password",{method:"POST",body:JSON.stringify({current:j.current,next:j.next})}),_("✓ 密码已更新"),w({current:"",next:"",confirm:""})}catch(e){_("✗ ".concat(e.message))}}async function A(){T.alias&&T.target_url&&(await (0,s.SC)("/service-aliases",{method:"POST",body:JSON.stringify(T)}),k({alias:"",target_url:""}),O())}async function U(e){await (0,s.SC)("/service-aliases/".concat(e),{method:"DELETE"}),O()}return(0,a.useEffect)(()=>{O()},[]),(0,n.jsxs)("div",{className:"space-y-8 max-w-2xl",children:[(0,n.jsx)("h1",{className:"text-xl font-semibold text-white",children:"设置"}),(0,n.jsx)(l,{title:"授权与版本",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("span",{className:"text-gray-400",children:"当前版本"}),(0,n.jsx)("span",{className:"text-white font-medium capitalize",children:null!==(e=d.license_tier)&&void 0!==e?e:"free"}),(0,n.jsx)("span",{className:"text-xs px-2 py-0.5 rounded ".concat("active"===d.license_status?"bg-green-900/50 text-green-400":"bg-gray-800 text-gray-500"),children:"active"===d.license_status?"已激活":"未激活"})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("input",{value:m,onChange:e=>p(e.target.value),placeholder:"AG-XXXX-XXXX-XXXX-XXXX",className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm font-mono focus:outline-none focus:border-blue-500"}),(0,n.jsx)("button",{onClick:L,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm",children:"激活"})]}),f&&(0,n.jsx)("p",{className:"text-xs ".concat(b?"text-green-400":"text-red-400"),children:f})]})}),(0,n.jsx)(l,{title:"安全认证",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"会话超时（分钟）"}),(0,n.jsx)("input",{value:null!==(t=d.dashboard_session_timeout)&&void 0!==t?t:"1440",onChange:e=>x(t=>({...t,dashboard_session_timeout:e.target.value})),type:"number",className:"w-32 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]}),(0,n.jsxs)("div",{className:"border-t border-gray-800 pt-3 space-y-2",children:[(0,n.jsx)("p",{className:"text-xs text-gray-400 font-medium",children:"修改 Dashboard 密码"}),(0,n.jsx)("input",{value:j.current,onChange:e=>w(t=>({...t,current:e.target.value})),type:"password",placeholder:"当前密码",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"}),(0,n.jsx)("input",{value:j.next,onChange:e=>w(t=>({...t,next:e.target.value})),type:"password",placeholder:"新密码",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"}),(0,n.jsx)("input",{value:j.confirm,onChange:e=>w(t=>({...t,confirm:e.target.value})),type:"password",placeholder:"确认新密码",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"}),(0,n.jsx)("button",{onClick:I,className:"bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg text-sm",children:"更新密码"}),N&&(0,n.jsx)("p",{className:"text-xs ".concat(N.startsWith("✓")?"text-green-400":"text-red-400"),children:N})]})]})}),(0,n.jsx)(l,{title:"代理配置",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"代理端口"}),(0,n.jsx)("input",{value:null!==(r=d.proxy_port)&&void 0!==r?r:"8080",onChange:e=>x(t=>({...t,proxy_port:e.target.value})),type:"number",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"绑定地址"}),(0,n.jsx)("input",{value:null!==(o=d.proxy_bind)&&void 0!==o?o:"127.0.0.1",onChange:e=>x(t=>({...t,proxy_bind:e.target.value})),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"IP 白名单（逗号分隔，留空不限制）"}),(0,n.jsx)("input",{value:null!==(c=d.proxy_ip_whitelist)&&void 0!==c?c:"",onChange:e=>x(t=>({...t,proxy_ip_whitelist:e.target.value})),placeholder:"127.0.0.1,192.168.1.0/24",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]})]})}),(0,n.jsx)(l,{title:"服务别名",children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("div",{className:"space-y-2",children:S.map(e=>(0,n.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,n.jsx)("code",{className:"text-blue-400 w-28 shrink-0",children:e.alias}),(0,n.jsx)("span",{className:"text-gray-400 flex-1 truncate",children:e.target_url}),e.builtin?(0,n.jsx)("span",{className:"text-xs text-gray-600",children:"内置"}):(0,n.jsx)("button",{onClick:()=>U(e.id),className:"text-xs text-red-500 hover:text-red-400",children:"删除"})]},e.id))}),(0,n.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-800",children:[(0,n.jsx)("input",{value:T.alias,onChange:e=>k(t=>({...t,alias:e.target.value})),placeholder:"别名 (如 my-api)",className:"w-32 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"}),(0,n.jsx)("input",{value:T.target_url,onChange:e=>k(t=>({...t,target_url:e.target.value})),placeholder:"目标 URL (如 https://api.example.com)",className:"flex-1 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"}),(0,n.jsx)("button",{onClick:A,className:"bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-lg text-sm",children:"添加"})]})]})}),(0,n.jsx)(l,{title:"数据管理",children:(0,n.jsx)("div",{className:"space-y-3",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"日志保留天数"}),(0,n.jsx)("input",{value:null!==(u=d.log_retention_days)&&void 0!==u?u:"7",onChange:e=>x(t=>({...t,log_retention_days:e.target.value})),type:"number",min:"1",max:"365",className:"w-32 bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]})})}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("button",{onClick:P,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg text-sm font-medium",children:"保存设置"}),g&&(0,n.jsx)("span",{className:"text-green-400 text-sm",children:"✓ 已保存"})]}),(0,n.jsx)(l,{title:"危险操作",danger:!0,children:(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)(i,{label:"清空所有日志",confirm:"确认清空所有请求日志？此操作不可恢复。",onClick:async()=>{await (0,s.SC)("/settings/clear-logs",{method:"POST"}),alert("日志已清空")}}),(0,n.jsx)(i,{label:"重置所有规则",confirm:"确认重置所有规则为默认值？",onClick:async()=>{await (0,s.SC)("/settings/reset-rules",{method:"POST"}),alert("规则已重置")}})]})})]})}function l(e){let{title:t,children:r,danger:a}=e;return(0,n.jsxs)("div",{className:"bg-gray-900 border rounded-xl p-5 space-y-4 ".concat(a?"border-red-900/50":"border-gray-800"),children:[(0,n.jsx)("h2",{className:"text-sm font-medium ".concat(a?"text-red-400":"text-gray-300"),children:t}),r]})}function i(e){let{label:t,confirm:r,onClick:a}=e;return(0,n.jsx)("button",{onClick:()=>{window.confirm(r)&&a()},className:"text-sm text-red-400 hover:text-red-300 bg-red-900/20 hover:bg-red-900/40 px-4 py-2 rounded-lg border border-red-900/50",children:t})}},5118:function(e,t,r){"use strict";r.d(t,{SC:function(){return a},jl:function(){return s},kS:function(){return o}});let n=r(4859).env.NEXT_PUBLIC_API_URL||"/api";async function a(e,t){let r=localStorage.getItem("ag_token"),a=await fetch("".concat(n).concat(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...null==t?void 0:t.headers}});if(401===a.status)throw localStorage.removeItem("ag_token"),window.location.href="/login",Error("Unauthorized");if(!a.ok)throw Error((await a.json().catch(()=>({}))).message||"HTTP ".concat(a.status));return a.json()}function s(){return!!localStorage.getItem("ag_token")}function o(){localStorage.removeItem("ag_token"),window.location.href="/login"}}},function(e){e.O(0,[293,528,744],function(){return e(e.s=1044)}),_N_E=e.O()}]);