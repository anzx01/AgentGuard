(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[481],{793:function(e,t,a){Promise.resolve().then(a.bind(a,6250))},4859:function(e,t,a){"use strict";var s,r;e.exports=(null==(s=a.g.process)?void 0:s.env)&&"object"==typeof(null==(r=a.g.process)?void 0:r.env)?a.g.process:a(9566)},9566:function(e){!function(){var t={229:function(e){var t,a,s,r=e.exports={};function n(){throw Error("setTimeout has not been defined")}function l(){throw Error("clearTimeout has not been defined")}function o(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(a){try{return t.call(null,e,0)}catch(a){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{a="function"==typeof clearTimeout?clearTimeout:l}catch(e){a=l}}();var c=[],i=!1,x=-1;function u(){i&&s&&(i=!1,s.length?c=s.concat(c):x=-1,c.length&&d())}function d(){if(!i){var e=o(u);i=!0;for(var t=c.length;t;){for(s=c,c=[];++x<t;)s&&s[x].run();x=-1,t=c.length}s=null,i=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===l||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];c.push(new h(e,t)),1!==c.length||i||o(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw Error("process.chdir is not supported")},r.umask=function(){return 0}}},a={};function s(e){var r=a[e];if(void 0!==r)return r.exports;var n=a[e]={exports:{}},l=!0;try{t[e](n,n.exports,s),l=!1}finally{l&&delete a[e]}return n.exports}s.ab="//";var r=s(229);e.exports=r}()},6250:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return l}});var s=a(7573),r=a(7653),n=a(5118);function l(){var e;let[t,a]=(0,r.useState)([]),[l,c]=(0,r.useState)(0),[i,x]=(0,r.useState)(1),[u,d]=(0,r.useState)({status:"",service:"",q:""}),[h,m]=(0,r.useState)(null);async function g(){let e=new URLSearchParams({page:String(i),pageSize:String(50),...u.status&&{status:u.status},...u.service&&{service:u.service},...u.q&&{q:u.q}}),t=await (0,n.SC)("/logs?".concat(e));a(t.data),c(t.total)}(0,r.useEffect)(()=>{g()},[i,u]);let p=e=>"allow"===e?"text-green-400":"block"===e?"text-red-400":"text-orange-400";return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h1",{className:"text-xl font-semibold text-white",children:"实时日志"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)("select",{value:u.status,onChange:e=>{d(t=>({...t,status:e.target.value})),x(1)},className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:outline-none",children:[(0,s.jsx)("option",{value:"",children:"全部状态"}),(0,s.jsx)("option",{value:"allow",children:"通过"}),(0,s.jsx)("option",{value:"block",children:"阻断"}),(0,s.jsx)("option",{value:"error",children:"错误"})]}),(0,s.jsx)("input",{value:u.service,onChange:e=>{d(t=>({...t,service:e.target.value})),x(1)},placeholder:"服务名称...",className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:outline-none w-36"}),(0,s.jsx)("input",{value:u.q,onChange:e=>{d(t=>({...t,q:e.target.value})),x(1)},placeholder:"搜索 URL 或 Agent...",className:"bg-gray-800 border border-gray-700 rounded-lg px-3 py-1.5 text-sm text-gray-300 focus:outline-none w-56"}),(0,s.jsx)("button",{onClick:g,className:"bg-gray-800 hover:bg-gray-700 text-gray-300 px-3 py-1.5 rounded-lg text-sm",children:"刷新"}),(0,s.jsxs)("span",{className:"text-gray-500 text-sm self-center",children:["共 ",l," 条"]})]}),(0,s.jsx)("div",{className:"bg-gray-900 border border-gray-800 rounded-xl overflow-hidden",children:(0,s.jsxs)("div",{className:"overflow-x-auto",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-gray-500 text-xs border-b border-gray-800 bg-gray-900/80",children:[(0,s.jsx)("th",{className:"text-left px-4 py-3 font-normal",children:"时间"}),(0,s.jsx)("th",{className:"text-left px-4 py-3 font-normal",children:"Agent"}),(0,s.jsx)("th",{className:"text-left px-4 py-3 font-normal",children:"服务"}),(0,s.jsx)("th",{className:"text-left px-4 py-3 font-normal",children:"方法"}),(0,s.jsx)("th",{className:"text-left px-4 py-3 font-normal",children:"状态"}),(0,s.jsx)("th",{className:"text-right px-4 py-3 font-normal",children:"延迟"}),(0,s.jsx)("th",{className:"text-right px-4 py-3 font-normal",children:"费用"}),(0,s.jsx)("th",{className:"text-right px-4 py-3 font-normal",children:"操作"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-800",children:t.map(e=>{var t;return(0,s.jsxs)("tr",{className:"hover:bg-gray-800/50 ".concat("block"===e.decision?"bg-red-950/10":""),children:[(0,s.jsx)("td",{className:"px-4 py-2.5 text-gray-500 text-xs whitespace-nowrap",children:new Date(e.timestamp).toLocaleTimeString()}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-gray-300",children:null!==(t=e.agent_name)&&void 0!==t?t:"-"}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-gray-300",children:e.target_service}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-gray-400 text-xs",children:e.method}),(0,s.jsx)("td",{className:"px-4 py-2.5",children:(0,s.jsx)("span",{className:"text-xs font-medium ".concat(p(e.decision)),children:"allow"===e.decision?"✓ 通过":"block"===e.decision?"✗ 阻断":"⚠ 错误"})}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-right text-gray-500 text-xs",children:null!=e.latency_ms?"".concat(e.latency_ms.toFixed(0),"ms"):"-"}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-right text-gray-400 text-xs",children:e.estimated_cost>0?"$".concat(e.estimated_cost.toFixed(3)):"-"}),(0,s.jsx)("td",{className:"px-4 py-2.5 text-right",children:(0,s.jsx)("button",{onClick:()=>m(e),className:"text-xs text-blue-400 hover:text-blue-300",children:"详情"})})]},e.id)})})]}),0===t.length&&(0,s.jsx)("p",{className:"text-center text-gray-500 py-10",children:"暂无日志记录"})]})}),l>50&&(0,s.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,s.jsx)("button",{onClick:()=>x(e=>Math.max(1,e-1)),disabled:1===i,className:"px-3 py-1 rounded bg-gray-800 text-gray-300 text-sm disabled:opacity-40",children:"上一页"}),(0,s.jsxs)("span",{className:"text-gray-400 text-sm",children:["第 ",i," 页 / 共 ",Math.ceil(l/50)," 页"]}),(0,s.jsx)("button",{onClick:()=>x(e=>e+1),disabled:i>=Math.ceil(l/50),className:"px-3 py-1 rounded bg-gray-800 text-gray-300 text-sm disabled:opacity-40",children:"下一页"})]}),h&&(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex justify-end",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>m(null)}),(0,s.jsxs)("div",{className:"relative w-full max-w-md bg-gray-900 border-l border-gray-800 h-full overflow-y-auto p-6 space-y-5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"font-semibold text-white",children:"请求详情"}),(0,s.jsx)("button",{onClick:()=>m(null),className:"text-gray-400 hover:text-white text-xl",children:"\xd7"})]}),(0,s.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,s.jsx)(o,{label:"事务 ID",value:h.id,mono:!0}),(0,s.jsx)(o,{label:"时间",value:new Date(h.timestamp).toLocaleString()}),(0,s.jsx)(o,{label:"Agent",value:null!==(e=h.agent_name)&&void 0!==e?e:"-"}),(0,s.jsx)(o,{label:"目标服务",value:h.target_service}),(0,s.jsx)(o,{label:"目标 URL",value:h.target_url,mono:!0}),(0,s.jsx)(o,{label:"方法",value:h.method}),(0,s.jsx)(o,{label:"响应状态",value:h.response_status?String(h.response_status):"-"}),(0,s.jsx)(o,{label:"延迟",value:null!=h.latency_ms?"".concat(h.latency_ms.toFixed(1),"ms"):"-"}),(0,s.jsx)(o,{label:"预估费用",value:h.estimated_cost>0?"$".concat(h.estimated_cost.toFixed(4)):"-"}),(0,s.jsxs)("div",{className:"border-t border-gray-800 pt-3",children:[(0,s.jsx)("p",{className:"text-gray-500 text-xs mb-2",children:"决策信息"}),(0,s.jsx)(o,{label:"决策",value:"allow"===h.decision?"✓ 通过":"✗ 阻断",valueClass:"allow"===h.decision?"text-green-400":"text-red-400"}),h.block_reason&&(0,s.jsx)(o,{label:"阻断原因",value:h.block_reason})]})]})]})]})]})}function o(e){let{label:t,value:a,mono:r,valueClass:n}=e;return(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("span",{className:"text-gray-500 w-24 shrink-0",children:t}),(0,s.jsx)("span",{className:"text-gray-200 break-all ".concat(r?"font-mono text-xs":""," ").concat(null!=n?n:""),children:a})]})}},5118:function(e,t,a){"use strict";a.d(t,{SC:function(){return r},jl:function(){return n},kS:function(){return l}});let s=a(4859).env.NEXT_PUBLIC_API_URL||"/api";async function r(e,t){let a=localStorage.getItem("ag_token"),r=await fetch("".concat(s).concat(e),{...t,headers:{"Content-Type":"application/json",...a?{Authorization:"Bearer ".concat(a)}:{},...null==t?void 0:t.headers}});if(401===r.status)throw localStorage.removeItem("ag_token"),window.location.href="/login",Error("Unauthorized");if(!r.ok)throw Error((await r.json().catch(()=>({}))).message||"HTTP ".concat(r.status));return r.json()}function n(){return!!localStorage.getItem("ag_token")}function l(){localStorage.removeItem("ag_token"),window.location.href="/login"}}},function(e){e.O(0,[293,528,744],function(){return e(e.s=793)}),_N_E=e.O()}]);