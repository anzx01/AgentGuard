(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[716],{9501:function(e,t,r){Promise.resolve().then(r.bind(r,9374))},4859:function(e,t,r){"use strict";var a,n;e.exports=(null==(a=r.g.process)?void 0:a.env)&&"object"==typeof(null==(n=r.g.process)?void 0:n.env)?r.g.process:r(9566)},9566:function(e){!function(){var t={229:function(e){var t,r,a,n=e.exports={};function l(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===l||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:l}catch(e){t=l}try{r="function"==typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var o=[],c=!1,u=-1;function d(){c&&a&&(c=!1,a.length?o=a.concat(o):u=-1,o.length&&m())}function m(){if(!c){var e=s(d);c=!0;for(var t=o.length;t;){for(a=o,o=[];++u<t;)a&&a[u].run();u=-1,t=o.length}a=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function x(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new p(e,t)),1!==o.length||c||s(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=x,n.addListener=x,n.once=x,n.off=x,n.removeListener=x,n.removeAllListeners=x,n.emit=x,n.prependListener=x,n.prependOnceListener=x,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},r={};function a(e){var n=r[e];if(void 0!==n)return n.exports;var l=r[e]={exports:{}},i=!0;try{t[e](l,l.exports,a),i=!1}finally{i&&delete r[e]}return l.exports}a.ab="//";var n=a(229);e.exports=n}()},9374:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var a=r(7573),n=r(7653),l=r(5118);let i=[{value:"daily_budget",label:"每日预算上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"monthly_budget",label:"每月预算上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"per_call_limit",label:"单次调用上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"rate_limit",label:"频率限制",paramKey:"max",paramLabel:"次数/窗口",type:"number"},{value:"domain_whitelist",label:"域名白名单",paramKey:"domains",paramLabel:"域名列表 (逗号分隔)",type:"text"},{value:"domain_blacklist",label:"域名黑名单",paramKey:"domains",paramLabel:"域名列表 (逗号分隔)",type:"text"},{value:"method_restriction",label:"方法限制",paramKey:"methods",paramLabel:"方法列表 (逗号分隔)",type:"text"},{value:"time_window_block",label:"时间窗口封锁",paramKey:"start",paramLabel:"开始小时 (0-23)",type:"number"}],s=e=>{var t,r;return null!==(r=null===(t=i.find(t=>t.value===e))||void 0===t?void 0:t.label)&&void 0!==r?r:e};function o(){var e,t,r;let[o,c]=(0,n.useState)([]),[u,d]=(0,n.useState)({}),[m,p]=(0,n.useState)(""),[x,y]=(0,n.useState)(!1),[b,g]=(0,n.useState)({type:"daily_budget",paramValue:"",priority:"50",description:""}),[h,f]=(0,n.useState)(!1),[v,j]=(0,n.useState)("");async function N(){let e=await (0,l.SC)("/rule-sets");c(e.ruleSets),e.ruleSets.length>0&&!m&&p(e.ruleSets[0].id)}async function w(e){let t=await (0,l.SC)("/rule-sets/".concat(e,"/rules"));d(r=>({...r,[e]:t.rules}))}async function _(e){e.preventDefault(),f(!0),j("");try{let e=i.find(e=>e.value===b.type),t={};"number"===e.type?(t[e.paramKey]=Number(b.paramValue),"rate_limit"===b.type&&(t.window_seconds=3600),"time_window_block"===b.type&&(t.end=(Number(b.paramValue)+8)%24)):t[e.paramKey]=b.paramValue.split(",").map(e=>e.trim()).filter(Boolean),await (0,l.SC)("/rule-sets/".concat(m,"/rules"),{method:"POST",body:JSON.stringify({name:b.type,type:b.type,params:t,priority:Number(b.priority),description:b.description||null})}),y(!1),g({type:"daily_budget",paramValue:"",priority:"50",description:""}),w(m)}catch(e){j(e.message)}finally{f(!1)}}async function S(e){await (0,l.SC)("/rules/".concat(e.id),{method:"PUT",body:JSON.stringify({is_enabled:!e.enabled})}),w(m)}async function k(e){confirm("确认删除此规则？")&&(await (0,l.SC)("/rules/".concat(e),{method:"DELETE"}),w(m))}(0,n.useEffect)(()=>{N()},[]),(0,n.useEffect)(()=>{m&&w(m)},[m]);let T=null!==(e=u[m])&&void 0!==e?e:[],C=i.find(e=>e.value===b.type);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-white",children:"规则配置"}),(0,a.jsx)("div",{className:"flex gap-2 border-b border-gray-800 pb-0",children:o.map(e=>(0,a.jsx)("button",{onClick:()=>p(e.id),className:"px-4 py-2 text-sm rounded-t-lg border-b-2 transition-colors ".concat(m===e.id?"border-blue-500 text-blue-400 bg-gray-900":"border-transparent text-gray-500 hover:text-gray-300"),children:e.name},e.id))}),m&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[T.length," 条规则"]}),(0,a.jsx)("button",{onClick:()=>y(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"+ 添加规则"})]}),x&&(0,a.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-5",children:[(0,a.jsx)("h2",{className:"text-sm font-medium text-gray-300 mb-4",children:"新建规则"}),(0,a.jsxs)("form",{onSubmit:_,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"规则类型 *"}),(0,a.jsx)("select",{value:b.type,onChange:e=>g(t=>({...t,type:e.target.value,paramValue:""})),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",children:i.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block text-xs text-gray-400 mb-1",children:[null!==(t=null==C?void 0:C.paramLabel)&&void 0!==t?t:"参数"," *"]}),(0,a.jsx)("input",{value:b.paramValue,onChange:e=>g(t=>({...t,paramValue:e.target.value})),type:null!==(r=null==C?void 0:C.type)&&void 0!==r?r:"text",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",required:!0})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"优先级 (数字越小越高)"}),(0,a.jsx)("input",{value:b.priority,onChange:e=>g(t=>({...t,priority:e.target.value})),type:"number",min:"1",max:"100",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-gray-400 mb-1",children:"描述"}),(0,a.jsx)("input",{value:b.description,onChange:e=>g(t=>({...t,description:e.target.value})),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",placeholder:"可选"})]})]}),v&&(0,a.jsx)("p",{className:"text-red-400 text-xs",children:v}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{type:"submit",disabled:h,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-4 py-2 rounded-lg text-sm",children:h?"创建中...":"创建"}),(0,a.jsx)("button",{type:"button",onClick:()=>y(!1),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg text-sm",children:"取消"})]})]})]}),0===T.length&&!x&&(0,a.jsxs)("div",{className:"text-center py-16 text-gray-500",children:[(0,a.jsx)("p",{className:"text-4xl mb-3",children:"⚙"}),(0,a.jsx)("p",{children:'暂无规则，点击"添加规则"开始配置'})]}),(0,a.jsx)("div",{className:"space-y-2",children:T.sort((e,t)=>e.priority-t.priority).map(e=>(0,a.jsx)("div",{className:"bg-gray-900 border rounded-xl p-4 ".concat(e.enabled?"border-gray-800":"border-gray-800 opacity-50"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xs text-gray-600 w-6 text-center",children:e.priority}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-white",children:s(e.type)}),!e.enabled&&(0,a.jsx)("span",{className:"text-xs text-gray-600 bg-gray-800 px-2 py-0.5 rounded",children:"已禁用"})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[JSON.stringify(e.params),e.description&&" — ".concat(e.description)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{onClick:()=>S(e),className:"text-xs px-3 py-1 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-300",children:e.enabled?"禁用":"启用"}),(0,a.jsx)("button",{onClick:()=>k(e.id),className:"text-xs px-3 py-1 rounded-lg bg-red-900/50 hover:bg-red-900 text-red-400",children:"删除"})]})]})},e.id))})]})]})}},5118:function(e,t,r){"use strict";r.d(t,{SC:function(){return n},jl:function(){return l},kS:function(){return i}});let a=r(4859).env.NEXT_PUBLIC_API_URL||"/api";async function n(e,t){let r=localStorage.getItem("ag_token"),n=await fetch("".concat(a).concat(e),{...t,headers:{"Content-Type":"application/json",...r?{Authorization:"Bearer ".concat(r)}:{},...null==t?void 0:t.headers}});if(401===n.status)throw localStorage.removeItem("ag_token"),window.location.href="/login",Error("Unauthorized");if(!n.ok)throw Error((await n.json().catch(()=>({}))).message||"HTTP ".concat(n.status));return n.json()}function l(){return!!localStorage.getItem("ag_token")}function i(){localStorage.removeItem("ag_token"),window.location.href="/login"}}},function(e){e.O(0,[293,528,744],function(){return e(e.s=9501)}),_N_E=e.O()}]);