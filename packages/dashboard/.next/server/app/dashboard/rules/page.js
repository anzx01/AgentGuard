(()=>{var e={};e.id=716,e.ids=[716],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1306:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>x,pages:()=>c,routeModule:()=>u,tree:()=>o}),t(8096),t(4341),t(7718),t(7824);var r=t(3282),s=t(5736),l=t(3906),i=t.n(l),n=t(6880),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(a,d);let o=["",{children:["dashboard",{children:["rules",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,8096)),"G:\\myaist\\AgentGuard\\packages\\dashboard\\src\\app\\dashboard\\rules\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,4341)),"G:\\myaist\\AgentGuard\\packages\\dashboard\\src\\app\\dashboard\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,7718)),"G:\\myaist\\AgentGuard\\packages\\dashboard\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,7824,23)),"next/dist/client/components/not-found-error"]}],c=["G:\\myaist\\AgentGuard\\packages\\dashboard\\src\\app\\dashboard\\rules\\page.tsx"],x="/dashboard/rules/page",p={require:t,loadChunk:()=>Promise.resolve()},u=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/dashboard/rules/page",pathname:"/dashboard/rules",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},4224:(e,a,t)=>{Promise.resolve().then(t.t.bind(t,4424,23)),Promise.resolve().then(t.t.bind(t,7752,23)),Promise.resolve().then(t.t.bind(t,5275,23)),Promise.resolve().then(t.t.bind(t,9842,23)),Promise.resolve().then(t.t.bind(t,1633,23)),Promise.resolve().then(t.t.bind(t,9224,23))},4893:(e,a,t)=>{Promise.resolve().then(t.bind(t,4811))},8144:()=>{},2684:(e,a,t)=>{Promise.resolve().then(t.bind(t,1394)),Promise.resolve().then(t.bind(t,8946))},4811:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>d});var r=t(3227),s=t(3677),l=t(7674);let i=[{value:"daily_budget",label:"每日预算上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"monthly_budget",label:"每月预算上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"per_call_limit",label:"单次调用上限",paramKey:"limit",paramLabel:"金额 ($)",type:"number"},{value:"rate_limit",label:"频率限制",paramKey:"max",paramLabel:"次数/窗口",type:"number"},{value:"domain_whitelist",label:"域名白名单",paramKey:"domains",paramLabel:"域名列表 (逗号分隔)",type:"text"},{value:"domain_blacklist",label:"域名黑名单",paramKey:"domains",paramLabel:"域名列表 (逗号分隔)",type:"text"},{value:"method_restriction",label:"方法限制",paramKey:"methods",paramLabel:"方法列表 (逗号分隔)",type:"text"},{value:"time_window_block",label:"时间窗口封锁",paramKey:"start",paramLabel:"开始小时 (0-23)",type:"number"}],n=e=>i.find(a=>a.value===e)?.label??e;function d(){let[e,a]=(0,s.useState)([]),[t,d]=(0,s.useState)({}),[o,c]=(0,s.useState)(""),[x,p]=(0,s.useState)(!1),[u,m]=(0,s.useState)({type:"daily_budget",paramValue:"",priority:"50",description:""}),[b,g]=(0,s.useState)(!1),[h,y]=(0,s.useState)("");async function f(e){let a=await (0,l.SC)(`/rule-sets/${e}/rules`);d(t=>({...t,[e]:a.rules}))}async function v(e){e.preventDefault(),g(!0),y("");try{let e=i.find(e=>e.value===u.type),a={};"number"===e.type?(a[e.paramKey]=Number(u.paramValue),"rate_limit"===u.type&&(a.window_seconds=3600),"time_window_block"===u.type&&(a.end=(Number(u.paramValue)+8)%24)):a[e.paramKey]=u.paramValue.split(",").map(e=>e.trim()).filter(Boolean),await (0,l.SC)(`/rule-sets/${o}/rules`,{method:"POST",body:JSON.stringify({name:u.type,type:u.type,params:a,priority:Number(u.priority),description:u.description||null})}),p(!1),m({type:"daily_budget",paramValue:"",priority:"50",description:""}),f(o)}catch(e){y(e.message)}finally{g(!1)}}async function j(e){await (0,l.SC)(`/rules/${e.id}`,{method:"PUT",body:JSON.stringify({is_enabled:!e.enabled})}),f(o)}async function N(e){confirm("确认删除此规则？")&&(await (0,l.SC)(`/rules/${e}`,{method:"DELETE"}),f(o))}let w=t[o]??[],_=i.find(e=>e.value===u.type);return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h1",{className:"text-xl font-semibold text-white",children:"规则配置"}),r.jsx("div",{className:"flex gap-2 border-b border-gray-800 pb-0",children:e.map(e=>r.jsx("button",{onClick:()=>c(e.id),className:`px-4 py-2 text-sm rounded-t-lg border-b-2 transition-colors ${o===e.id?"border-blue-500 text-blue-400 bg-gray-900":"border-transparent text-gray-500 hover:text-gray-300"}`,children:e.name},e.id))}),o&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[w.length," 条规则"]}),r.jsx("button",{onClick:()=>p(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium",children:"+ 添加规则"})]}),x&&(0,r.jsxs)("div",{className:"bg-gray-900 border border-gray-800 rounded-xl p-5",children:[r.jsx("h2",{className:"text-sm font-medium text-gray-300 mb-4",children:"新建规则"}),(0,r.jsxs)("form",{onSubmit:v,className:"space-y-3",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"规则类型 *"}),r.jsx("select",{value:u.type,onChange:e=>m(a=>({...a,type:e.target.value,paramValue:""})),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",children:i.map(e=>r.jsx("option",{value:e.value,children:e.label},e.value))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-gray-400 mb-1",children:[_?.paramLabel??"参数"," *"]}),r.jsx("input",{value:u.paramValue,onChange:e=>m(a=>({...a,paramValue:e.target.value})),type:_?.type??"text",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",required:!0})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"优先级 (数字越小越高)"}),r.jsx("input",{value:u.priority,onChange:e=>m(a=>({...a,priority:e.target.value})),type:"number",min:"1",max:"100",className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"描述"}),r.jsx("input",{value:u.description,onChange:e=>m(a=>({...a,description:e.target.value})),className:"w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:outline-none",placeholder:"可选"})]})]}),h&&r.jsx("p",{className:"text-red-400 text-xs",children:h}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{type:"submit",disabled:b,className:"bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white px-4 py-2 rounded-lg text-sm",children:b?"创建中...":"创建"}),r.jsx("button",{type:"button",onClick:()=>p(!1),className:"bg-gray-800 hover:bg-gray-700 text-gray-300 px-4 py-2 rounded-lg text-sm",children:"取消"})]})]})]}),0===w.length&&!x&&(0,r.jsxs)("div",{className:"text-center py-16 text-gray-500",children:[r.jsx("p",{className:"text-4xl mb-3",children:"⚙"}),r.jsx("p",{children:'暂无规则，点击"添加规则"开始配置'})]}),r.jsx("div",{className:"space-y-2",children:w.sort((e,a)=>e.priority-a.priority).map(e=>r.jsx("div",{className:`bg-gray-900 border rounded-xl p-4 ${e.enabled?"border-gray-800":"border-gray-800 opacity-50"}`,children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-600 w-6 text-center",children:e.priority}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-sm font-medium text-white",children:n(e.type)}),!e.enabled&&r.jsx("span",{className:"text-xs text-gray-600 bg-gray-800 px-2 py-0.5 rounded",children:"已禁用"})]}),(0,r.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:[JSON.stringify(e.params),e.description&&` — ${e.description}`]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>j(e),className:"text-xs px-3 py-1 rounded-lg bg-gray-800 hover:bg-gray-700 text-gray-300",children:e.enabled?"禁用":"启用"}),r.jsx("button",{onClick:()=>N(e.id),className:"text-xs px-3 py-1 rounded-lg bg-red-900/50 hover:bg-red-900 text-red-400",children:"删除"})]})]})},e.id))})]})]})}},1394:(e,a,t)=>{"use strict";t.d(a,{default:()=>o});var r=t(3227),s=t(649),l=t(1043),i=t(7674),n=t(1126);let d=[{href:"/dashboard",label:"总览",icon:"◉"},{href:"/dashboard/agents",label:"Agent",icon:"⬡"},{href:"/dashboard/rules",label:"规则",icon:"⚙"},{href:"/dashboard/logs",label:"日志",icon:"≡"},{href:"/dashboard/alerts",label:"告警",icon:"⚠"},{href:"/dashboard/settings",label:"设置",icon:"⊙"}];function o(){let e=(0,l.usePathname)();return(0,r.jsxs)("aside",{className:"w-52 shrink-0 bg-gray-900 border-r border-gray-800 flex flex-col min-h-screen",children:[(0,r.jsxs)("div",{className:"px-4 py-5 border-b border-gray-800",children:[r.jsx("span",{className:"font-bold text-white text-lg",children:"AgentGuard"}),r.jsx("span",{className:"ml-2 text-xs text-gray-500",children:"v1.0"})]}),r.jsx("nav",{className:"flex-1 py-4 space-y-1 px-2",children:d.map(a=>(0,r.jsxs)(s.default,{href:a.href,className:(0,n.Z)("flex items-center gap-3 px-3 py-2 rounded-lg text-sm transition-colors",e===a.href?"bg-blue-600 text-white":"text-gray-400 hover:text-white hover:bg-gray-800"),children:[r.jsx("span",{children:a.icon}),r.jsx("span",{children:a.label})]},a.href))}),r.jsx("div",{className:"p-4 border-t border-gray-800",children:r.jsx("button",{onClick:i.kS,className:"w-full text-left text-xs text-gray-500 hover:text-gray-300 transition-colors",children:"退出登录"})})]})}},8946:(e,a,t)=>{"use strict";t.d(a,{default:()=>i});var r=t(3227),s=t(3677),l=t(7674);function i(){let[e,a]=(0,s.useState)({global:{paused:!1}}),[t,i]=(0,s.useState)(!1);async function n(){if(e.global.paused)await (0,l.SC)("/kill-switch/deactivate",{method:"POST",body:JSON.stringify({scope:"global"})}),a({global:{paused:!1}});else{if(!t){i(!0);return}await (0,l.SC)("/kill-switch/activate",{method:"POST",body:JSON.stringify({reason:"手动触发",scope:"global"})}),a({global:{paused:!0}}),i(!1)}}return(0,r.jsxs)("header",{className:"h-14 bg-gray-900 border-b border-gray-800 flex items-center justify-between px-6 shrink-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:`w-2 h-2 rounded-full ${e.global.paused?"bg-red-500":"bg-green-500"}`}),r.jsx("span",{className:"text-sm text-gray-400",children:e.global.paused?"已暂停":"运行中"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t&&r.jsx("span",{className:"text-xs text-yellow-400",children:"再次点击确认暂停所有请求"}),r.jsx("button",{onClick:n,onBlur:()=>i(!1),className:`px-4 py-1.5 rounded-lg text-sm font-medium transition-colors ${e.global.paused?"bg-green-700 hover:bg-green-600 text-white":t?"bg-red-500 hover:bg-red-400 text-white":"bg-red-900 hover:bg-red-800 text-red-300"}`,children:e.global.paused?"▶ 恢复服务":"■ Kill Switch"})]})]})}},7674:(e,a,t)=>{"use strict";t.d(a,{SC:()=>s,kS:()=>l});let r=process.env.NEXT_PUBLIC_API_URL||"/api";async function s(e,a){let t=await fetch(`${r}${e}`,{...a,headers:{"Content-Type":"application/json",...a?.headers}});if(401===t.status)throw Error("Unauthorized");if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||`HTTP ${t.status}`);return t.json()}function l(){localStorage.removeItem("ag_token"),window.location.href="/login"}},4341:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n});var r=t(9013),s=t(3189);let l=(0,s.createProxy)(String.raw`G:\myaist\AgentGuard\packages\dashboard\src\components\Sidebar.tsx#default`),i=(0,s.createProxy)(String.raw`G:\myaist\AgentGuard\packages\dashboard\src\components\TopBar.tsx#default`);function n({children:e}){return(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[r.jsx(l,{}),(0,r.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[r.jsx(i,{}),r.jsx("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-950",children:e})]})]})}},8096:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>r});let r=(0,t(3189).createProxy)(String.raw`G:\myaist\AgentGuard\packages\dashboard\src\app\dashboard\rules\page.tsx#default`)},7718:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>l,metadata:()=>s});var r=t(9013);t(5556);let s={title:"AgentGuard",description:"AI Agent API 安全代理网关"};function l({children:e}){return r.jsx("html",{lang:"zh-CN",children:r.jsx("body",{className:"bg-gray-950 text-gray-100 min-h-screen",children:e})})}},5556:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),r=a.X(0,[592,914],()=>t(1306));module.exports=r})();